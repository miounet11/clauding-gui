# 版本 2.1.0 发布说明

发布日期：2025-08-05

## 🔄 核心逻辑重构

这个版本对 Claude CLI 的执行逻辑进行了重要的简化和重构，旨在解决连接问题并提高稳定性。

### 主要更改

#### 1. **简化环境变量处理**
- 移除了复杂的环境变量白名单过滤逻辑
- 现在完全继承父进程的所有环境变量
- 与终端中直接执行 Claude CLI 的行为完全一致

#### 2. **还原核心逻辑**
- 回到最基本、最可靠的实现方式
- 确保与原始 Claudia 项目的核心逻辑保持一致
- 移除了可能导致问题的过度"智能化"处理

#### 3. **新增诊断工具**
- 添加了 `test_claude_connectivity` 命令用于调试
- 可以直接测试 Claude CLI 是否能正常执行
- 仅在开发模式下可用，确保生产环境安全

### 解决的问题

#### ✅ 修复 "API Error: Connection error"
- 通过简化环境变量处理解决了连接问题
- Claude CLI 现在可以接收到与终端执行时相同的环境配置
- 提高了与不同系统配置和网络环境的兼容性

#### ✅ 提高稳定性
- 减少了环境变量处理中的潜在错误点
- 简化的逻辑更加可靠和可预测
- 更好地支持各种 Claude CLI 安装方式

### 技术改进

- 简化了 `create_command_with_env` 函数
- 完全继承系统环境，避免遗漏关键配置
- 添加了更好的调试和日志记录

### 升级建议

如果您之前遇到 Claude 连接问题，建议立即升级到此版本。这个版本的核心逻辑更加简单可靠，应该能解决大部分连接相关的问题。

### 验证方法

升级后，您应该能够：
1. 正常发送消息给 Claude 而不出现连接错误
2. 获得与终端中使用 Claude CLI 相同的体验
3. 在各种网络环境下稳定工作